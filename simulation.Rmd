---
title: "Data simulation"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,fig.width=12, fig.height=8)
```

This is an R Markdown document. It shows how to simulate data from the AR(p)-Laplace model. Take $y_{t,m}$ as the estimate of $y_t$ through the method $m$. Then,

## Equations
. $y_{t,m} = (k_{1,m}U_{t,m}+k_{2,m}\sqrt{U_{t,m}}Z_{t,m})\sigma_m+y_t$, where $U_{t,m} \sim Exp(1)$ and $Z_{t,m} \sim N(0,1)$;

. $y_{t} = \sum_{i=1}^{p}\phi_iy_{t-i} + \epsilon_t$, where $\epsilon_t|\lambda_t \sim N(0,\sigma^2\lambda_t^{-1})$;

. $\lambda_t|\nu \sim G\Big(\frac{\nu}{2},\frac{\nu}{2}\Big)$.


## Example

### $\Rightarrow y_t$
We take:

. Sample size $n = 1000$;

. $p = 3$;

. $\boldsymbol{\phi} = (0.6,-0.2,0.1)$, $\nu = 4$, $\sigma^2 = 0.05$;

. $y_{-p} = y_{-p+1} = \dots = y_0 = 0$.

Then, it is possible to sample from the true value. 

```{r yt, echo=FALSE}
phi<-c(.6,-.2,.1)
nu<-4
sigma2<-0.05
n<-1000

sims<-function(n,phi,nu,sigma2){
  p<-length(phi)
  yt<-rep(0,p)
  for(i in 1:n){
    lam<-rgamma(1,nu/2,nu/2)
    yt[i+p]<-rnorm(1,sum(phi*yt[i+p-(1:p)]),sqrt(sigma2/lam))
  }
  yt<-yt[-(1:p)]
  return(yt)
}

yt<-sims(n,phi,nu,sigma2)
plot(yt,type='l', main = 'True value through time',xlab = 'Time', ylab=expression(bold(y[t])))
```

### $\Rightarrow y_{t,m}$
. Number of estimation methods $M = 4$;

. $\boldsymbol{\sigma} = (0.06,0.1,0.08,0.04)$, $\boldsymbol{\tau} = (0.3,0.4,0.6,0.7)$.

```{r pressure, echo=FALSE}
rald<-function(n,mu,sigma,tau){
  Z<-rnorm(n)
  U<-rexp(n)
  k1<-(1-2*tau)/(tau*(1-tau))
  k2<-2/(tau*(1-tau))
  Y<-sigma*(k1*U+sqrt(k2*U)*Z)+mu
  return(Y)
}

M<-4
sigma<-c(.06,.1,.08,.04)
tau<-c(.3,.4,.6,.7)

ytm<-matrix(0,nrow=n,ncol=M)

for(j in 1:M){
  for(i in 1:n)  ytm[i,j]<-rald(1,yt[i],sigma[j],tau[j])
}

library(grDevices)
plot(c(1,n),c(min(ytm),max(ytm)+1),type='n',ylab='',xlab='Time',main='Simulated data')
for(i in 1:M){
  lines(ytm[,i],type='l',col=adjustcolor(i+1, alpha.f = 0.5),lwd=2)
}
lines(yt,type='l',col='black',lwd=2,lty=2)
legend('topleft',c(paste('Method ',1:M),'True value'),col=c(adjustcolor(2:(M+1), alpha.f = 0.5),1),lty=c(rep(1,M),2),bty='n',cex=1.5)
```
